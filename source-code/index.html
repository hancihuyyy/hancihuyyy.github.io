<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title id="titleTag">hancihuyyy · Lihat Kode</title>

  <!-- GA (opsional) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-K5JQPNMVEF"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js',new Date());gtag('config','G-K5JQPNMVEF');</script>

  <!-- Tailwind & Font -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- highlight.js (tema gelap) -->
  <link id="hlTheme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"/>

  <style>
    :root{--c1:#0ea5e9;--c2:#22c55e;--acc:#22c55e}
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(99,102,241,.16), transparent 60%),
        radial-gradient(800px 420px at 10% 110%, rgba(14,165,233,.14), transparent 55%),
        linear-gradient(180deg,#0b1220,#0b1220);
      color:#e5e7eb;
    }
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);backdrop-filter:blur(8px);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.25);animation:fade .5s ease both}
    .btn-grad{background-image:linear-gradient(to right,var(--c1),var(--c2));transition:transform .15s,box-shadow .2s}
    .btn-grad:hover{transform:translateY(-1px);box-shadow:0 10px 30px rgba(34,197,94,.25)}
    .chip{font-size:.8rem;padding:.25rem .6rem;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06)}
    .muted{color:#9aa0a6}
    .fade{animation:fade .5s ease both}
    @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    pre{background:#0f172a;border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:1.1rem;white-space:pre-wrap;word-wrap:break-word}

    /* Loader overlay */
    .loader-wrap{
      position:fixed; inset:0; display:grid; place-items:center; z-index:40;
      background:linear-gradient(180deg,rgba(11,18,32,.92),rgba(11,18,32,.88));
      backdrop-filter: blur(6px);
      animation:fade .3s ease both;
    }
    .loader-card{
      width:min(720px,92vw);
      border-radius:18px; border:1px solid rgba(255,255,255,.1);
      background:rgba(255,255,255,.06);
      box-shadow:0 18px 60px rgba(0,0,0,.35);
      padding:22px 22px 18px;
      overflow:hidden;
    }
    .loader-title{display:flex;align-items:center;gap:10px}
    .loader-badge{font-size:.75rem;border:1px solid rgba(255,255,255,.18);padding:.25rem .5rem;border-radius:10px;background:rgba(255,255,255,.06)}
    .loader-line{font-weight:800;font-size:1.15rem}
    .skeleton{
      height: 220px; border-radius:12px; border:1px solid rgba(255,255,255,.1);
      background:linear-gradient(100deg, rgba(255,255,255,.06) 30%, rgba(255,255,255,.12) 45%, rgba(255,255,255,.06) 60%);
      background-size:200% 100%; animation: shimmer 1.3s ease-in-out infinite;
    }
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    /* Loader variants */
    .dots{display:flex; gap:8px; align-items:center;}
    .dot{width:10px;height:10px;border-radius:999px;background:linear-gradient(90deg,var(--c1),var(--acc));opacity:.9;animation:bounce 1s infinite}
    .dot:nth-child(2){animation-delay:.12s}.dot:nth-child(3){animation-delay:.24s}.dot:nth-child(4){animation-delay:.36s}
    @keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.6}40%{transform:translateY(-6px);opacity:1}}
    .bar{height:8px;border-radius:999px;background:rgba(255,255,255,.12);overflow:hidden}
    .bar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--c1),var(--acc));animation:grow 1.6s ease-in-out infinite}
    @keyframes grow{0%{width:0}50%{width:90%}100%{width:0}}
    .wave{position:relative;height:40px;overflow:hidden;border-radius:10px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12)}
    .wave::before,.wave::after{
      content:""; position:absolute; inset:-60% -20% auto -20%; height:160%; border-radius:50%;
      background:radial-gradient(circle at 50% 50%, var(--acc), transparent 60%);
      animation:float 3s ease-in-out infinite; opacity:.35; filter:blur(14px)
    }
    .wave::after{animation-delay:1.2s; opacity:.25}
    @keyframes float{0%,100%{transform:translateX(-10%) translateY(6px)}50%{transform:translateX(60%) translateY(-6px)}}

    /* Info Bar */
    #infoBar {position: fixed; inset-inline: 0; bottom: 0; z-index: 30; display: flex; justify-content: center; pointer-events: none;}
    .info-inner{
      pointer-events:auto; display:flex; gap:.5rem; flex-wrap:wrap; align-items:center;
      max-width: 72rem; width: calc(100% - 1rem); margin: .5rem auto; padding: .5rem .75rem;
      border-radius: 12px; border:1px solid rgba(255,255,255,.12);
      background: rgba(15,23,42,.6); backdrop-filter: blur(8px); box-shadow: 0 10px 30px rgba(0,0,0,.25);
      font-size: .84rem; color:#e5e7eb;
    }
    .info-chip{display:inline-flex; align-items:center; gap:.4rem; padding:.28rem .55rem; border-radius:999px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06); white-space: nowrap;}

    /* Tools (copy/unduh) */
    .pill{display:inline-flex;align-items:center;gap:.45rem;border-radius:999px;padding:.5rem .9rem;border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(6px);transition:transform .15s, box-shadow .2s, background .2s;}
    .pill svg{width:16px;height:16px;opacity:.9}
    .pill:hover{transform:translateY(-1px);box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .pill--grad{background-image:linear-gradient(to right,var(--c1),var(--c2));color:#fff;border-color:transparent}
    .pill--muted{background:rgba(255,255,255,.08)}
    .pill--muted:hover{background:rgba(255,255,255,.14)}
  </style>
</head>
<body>
  <!-- Loader -->
  <div id="loader" class="loader-wrap">
    <div class="loader-card">
      <div class="loader-title">
        <span class="loader-badge">Menyiapkan Viewer</span>
        <div id="variantDots" class="dots"></div>
        <div id="variantBar"  class="bar hidden"><span></span></div>
        <div id="variantWave" class="wave hidden"></div>
      </div>
      <h2 id="loaderLine" class="loader-line mt-3">memuat…</h2>
      <p class="muted text-sm mt-1">sebentar ya, tampilan kodenya lagi disusun rapi</p>
      <div class="skeleton mt-5"></div>
    </div>
  </div>

  <header class="max-w-5xl mx-auto px-4 sm:px-6 pt-6 pb-2 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <span class="chip">Viewer</span><span class="text-sm opacity-80">Penampil kode</span>
    </div>
    <a href="../create/source-code/" class="hidden sm:inline chip">Buat Kode</a>
  </header>

  <main class="max-w-5xl mx-auto px-4 sm:px-6 pb-28">
    <section class="card p-6 sm:p-8 mt-4">
      <h1 id="title" class="text-2xl sm:text-3xl font-extrabold">Memuat Kode…</h1>
      <p id="subtitle" class="mt-2 muted">Harap tunggu sebentar.</p>

      <div class="mt-6 flex items-center gap-2">
        <span class="chip" id="langChip">Jenis: -</span>
      </div>

      <div class="mt-6 relative">
        <pre class="opacity-0 transition-opacity duration-300"><code id="code" class="language-plaintext"></code></pre>

        <div class="absolute top-3 right-3 flex gap-2 opacity-0 transition-opacity duration-300" id="toolBtns">
          <!-- Salin -->
          <button id="copyBtn" class="pill pill--grad">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2"></rect>
              <rect x="2" y="2" width="13" height="13" rx="2"></rect>
            </svg>
            Salin
          </button>
          <!-- Unduh -->
          <a id="downloadBtn" class="pill pill--muted text-white" download>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 3v12"></path><path d="m7 10 5 5 5-5"></path><path d="M5 21h14"></path>
            </svg>
            Unduh
          </a>
        </div>
      </div>

      <div id="okBar" class="hidden mt-4 text-xs muted">Kode dimuat.</div>
      <div id="errBox" class="hidden mt-4 text-sm text-red-400">Gagal memuat kode.</div>

      <div class="mt-8 flex gap-3">
        <a href="../create/source-code/" class="px-4 py-2 rounded-lg btn-grad text-white font-semibold">Buat Kode Lain</a>
      </div>
    </section>
  </main>

  <!-- Info Bar -->
  <div id="infoBar" class="fade">
    <div class="info-inner">
      <span class="info-chip" id="ibName">Nama: -</span>
      <span class="info-chip" id="ibLang">Bahasa: -</span>
      <span class="info-chip" id="ibSize">Ukuran: -</span>
      <span class="info-chip" id="ibLines">Baris: -</span>
      <span class="info-chip" id="ibLoaded">Dimuat: -</span>
    </div>
  </div>

  <!-- highlight.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/lua.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/php.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cpp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/markdown.min.js"></script>

  <script>
    const $=(s)=>document.querySelector(s);

    const loader      = $('#loader');
    const loaderLine  = $('#loaderLine');
    const variantDots = $('#variantDots');
    const variantBar  = $('#variantBar');
    const variantWave = $('#variantWave');

    const titleTag = $('#titleTag');
    const titleEl  = $('#title');
    const subtitle = $('#subtitle');
    const codeEl   = $('#code');
    const langChip = $('#langChip');
    const okBar    = $('#okBar');
    const errBox   = $('#errBox');
    const toolBtns = $('#toolBtns');
    const copyBtn     = $('#copyBtn');
    const downloadBtn = $('#downloadBtn');

    const ibName = $('#ibName');
    const ibLang = $('#ibLang');
    const ibSize = $('#ibSize');
    const ibLines= $('#ibLines');
    const ibLoaded = $('#ibLoaded');

    // Kalimat loading (1x per refresh)
    const phrases = [
      'sedang membuat…','lagi mikirin kode…','otw ngambil file…','mengurai Base64…','memanggil highlight.js…',
      'sedang merapikan baris…','lagi cari kurung yang hilang…','pemanggilan variabel…','kompilasi imajinasi…',
      'saling sapa dengan semicolon…','mencari bug yang pemalu…','mendorong bit ke layar…','sinkronisasi naskah…',
      'memasang tema gelap…','mengikat dependensi…','membelai bracket…','menghela napas… lalu lanjut…',
      'menyusun huruf jadi logika…','berburu koma yang nyasar…','merapikan spasi tab…','menyelaraskan baris…','menyisir komentar lama…',
      'mengecek tanda titik koma…','mendeteksi variabel liar…','meluruskan kurung siku…','mengusir whitespace hantu…'
    ];
    loaderLine.textContent = phrases[Math.floor(Math.random()*phrases.length)];

    // Pilih varian loader + accent
    (function pickVariant(){
      const variants = [variantDots, variantBar, variantWave];
      const pick = variants[Math.floor(Math.random()*variants.length)];
      variants.forEach(v => v.classList.toggle('hidden', v!==pick));
      variantDots.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>';
      const accents = ['#22c55e','#10b981','#a855f7','#f59e0b','#f97316','#0ea5e9'];
      document.documentElement.style.setProperty('--acc', accents[Math.floor(Math.random()*accents.length)]);
    })();

    // Utils
    function setLang(lang){
      const l = (lang||'plaintext').toLowerCase();
      codeEl.className = `language-${l}`;
      langChip.textContent = `Jenis: ${l.toUpperCase()}`;
    }
    function showOk(){ okBar.classList.remove('hidden'); errBox.classList.add('hidden'); }
    function showErr(msg){ errBox.textContent = msg||'Gagal memuat kode.'; errBox.classList.remove('hidden'); }
    function decodeData(d){ try{ return JSON.parse(decodeURIComponent(atob(d))); }catch(e){ return null; } }
    function slugify(s){ return (s||'script').toString().trim().toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,'').replace(/\-+/g,'-').replace(/^\-+|\-+$/g,''); }
    function extFromLang(lang){ const m={javascript:'js',lua:'lua',python:'py',html:'html',css:'css',php:'php',java:'java',csharp:'cs',cpp:'cpp',json:'json',markdown:'md',xml:'xml',plaintext:'txt'}; return m[(lang||'').toLowerCase()]||'txt'; }
    function setDownload(nameBase, ext, codeText){
      const base = slugify(nameBase || 'script');
      const fname = (base.startsWith('script-') ? base : `script-${base}`) + '.' + (ext||'txt');
      const blob = new Blob([codeText||''], { type: 'text/plain;charset=utf-8' });
      const url  = URL.createObjectURL(blob);
      downloadBtn.href = url;
      downloadBtn.setAttribute('download', fname);
    }
    function formatBytes(n){ if(!Number.isFinite(n)) return '-'; const u=['B','KB','MB','GB']; let i=0; while(n>=1024 && i<u.length-1){n/=1024;i++;} return (i===0?n:n.toFixed(1))+' '+u[i]; }
    function updateInfoBar({name, lang, codeText}){
      const te = new TextEncoder();
      const bytes = te.encode(codeText||'').length;
      const lines = (codeText||'').split(/\r?\n/).length;
      ibName.textContent  = `Nama: ${name||'-'}`;
      ibLang.textContent  = `Bahasa: ${(lang||'plaintext').toUpperCase()}`;
      ibSize.textContent  = `Ukuran: ${formatBytes(bytes)}`;
      ibLines.textContent = `Baris: ${lines}`;
      const dt = new Date(); const pad=(x)=>String(x).padStart(2,'0');
      ibLoaded.textContent= `Dimuat: ${pad(dt.getHours())}:${pad(dt.getMinutes())}:${pad(dt.getSeconds())}`;
    }

    // Loader dari data (wajib)
    function loadFromData(d){
      const parsed = decodeData(d);
      if(!parsed) throw new Error('Data tidak valid');
      const {title,type,code} = parsed;
      setLang(type||'plaintext');
      titleEl.textContent = title || 'Kode Tanpa Judul';
      titleTag.textContent = `Kode: ${titleEl.textContent}`;
      codeEl.textContent = code || '';
      hljs.highlightElement(codeEl);
      showOk();

      const ext = extFromLang(type||'plaintext');
      setDownload(title || 'script', ext, code || '');
      updateInfoBar({ name: ((title || 'script') + '.' + ext), lang: type || 'plaintext', codeText: code || '' });
    }

    // Boot + minimum 6.5s loader
    (async ()=>{
      const p = new URLSearchParams(location.search);
      const data = p.get('data');

      const t0 = Date.now();
      let loadErr = null;

      try{
        if(data){ loadFromData(data); }
        else{ showErr("Tidak ada parameter 'data'."); }
        subtitle.textContent = ' ';
      }catch(e){
        loadErr = e;
        console.error(e); showErr(e.message||String(e));
      }

      const elapsed = Date.now() - t0;
      const remain  = Math.max(0, 6500 - elapsed); // minimal 6.5 detik
      setTimeout(()=>{
        loader.style.opacity = '0';
        loader.style.pointerEvents = 'none';
        setTimeout(()=> loader.remove(), 260);

        if(!loadErr){
          codeEl.parentElement.classList.remove('opacity-0');
          toolBtns.classList.remove('opacity-0');
        }
      }, remain);
    })();

    // Tools
    copyBtn.addEventListener('click', ()=>{
      const txt = codeEl.textContent || '';
      if(navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(txt).then(()=>{
          copyBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"></path></svg> Disalin`;
          setTimeout(()=>copyBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"></rect><rect x="2" y="2" width="13" height="13" rx="2"></rect></svg> Salin`,1500);
        });
      }else{
        const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
      }
    });
  </script>
</body>
</html>
