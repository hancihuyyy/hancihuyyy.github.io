<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>hancihuyyy · Buat Link Tugas</title>

  <!-- GA (opsional) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-K5JQPNMVEF"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js',new Date());gtag('config','G-K5JQPNMVEF');</script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{--c1:#0ea5e9;--c2:#22c55e}
    body{
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(99,102,241,.16), transparent 60%),
        radial-gradient(800px 420px at 10% 110%, rgba(14,165,233,.14), transparent 55%),
        linear-gradient(180deg,#0b1220,#0b1220);
      color:#e5e7eb;
    }
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);backdrop-filter:blur(8px);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.25);animation:fade .4s ease both}
    .btn-grad{background-image:linear-gradient(to right,var(--c1),var(--c2));transition:transform .12s,box-shadow .2s}
    .btn-grad:hover{transform:translateY(-1px);box-shadow:0 10px 30px rgba(34,197,94,.25)}
    .input{background:rgba(15,23,42,.6);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:.7rem .9rem}
    .muted{color:#9aa0a6}
    .chip{font-size:.8rem;padding:.25rem .6rem;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06)}
    .pill{display:inline-flex;align-items:center;gap:.45rem;border-radius:999px;padding:.5rem .9rem;border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(6px)}
    @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    code{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:.25rem .45rem;border-radius:8px}
    a.link{color:#7dd3fc;text-decoration:underline}
  </style>
</head>
<body>
  <header class="max-w-5xl mx-auto px-4 sm:px-6 pt-6 pb-2 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <span class="chip">Create</span>
      <span class="text-sm opacity-80">Generator Tautan Tugas</span>
    </div>
    <nav class="hidden sm:flex items-center gap-2">
      <a href="../task/" class="chip">Lihat Task</a>
      <a href="./source-code/" class="chip">Buat Kode</a>
    </nav>
  </header>

  <main class="max-w-5xl mx-auto px-4 sm:px-6 pb-24">
    <!-- FORM -->
    <section class="card p-6 sm:p-8 mt-4">
      <h1 class="text-2xl sm:text-3xl font-extrabold">Buat Link Tugas</h1>
      <p class="muted mt-2">Link akan mengarah ke domain ini (<code id="originShow"></code>), bukan repo lama.</p>

      <div class="mt-6 grid sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm mb-1">Platform</label>
          <select id="platform" class="input w-full">
            <option value="youtube">YouTube</option>
            <option value="roblox">Roblox</option>
            <option value="whatsapp">WhatsApp</option>
            <option value="tiktok">TikTok</option>
            <option value="lainnya">Lainnya</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-1">Aksi</label>
          <select id="action" class="input w-full">
            <!-- default akan diisi sesuai mapping platform -->
          </select>
          <p class="muted text-xs mt-1">Catatan: “any” hanya untuk YouTube. Platform lain pakai label spesifik.</p>
        </div>

        <div class="sm:col-span-2">
          <label class="block text-sm mb-1">Target URL (satu per baris)</label>
          <textarea id="targets" rows="5" class="input w-full" placeholder="https://contoh.link/pertama
https://contoh.link/kedua"></textarea>
          <p class="muted text-xs mt-1">URL tidak akan ditampilkan di halaman Task. Sistem hanya membuka, menunggu 11 detik, lalu menandai selesai otomatis.</p>
        </div>
      </div>

      <div class="mt-6 flex flex-wrap gap-3">
        <button id="genBtn" class="px-4 py-2 rounded-lg btn-grad text-white font-semibold">Buat Link</button>
        <button id="copyBtn" class="pill">📋 Salin</button>
        <a id="openBtn" class="pill" target="_blank">🔗 Buka</a>
      </div>

      <div class="mt-4">
        <label class="block text-sm mb-1">Hasil Link</label>
        <input id="result" class="input w-full" readonly />
      </div>
    </section>

    <!-- ANALISIS (jangan dihapus) -->
    <section id="analysis" class="card p-6 sm:p-8 mt-6">
      <h2 class="text-xl font-bold">Analisis</h2>
      <p class="muted mt-2">
        Bagian analisis ini sengaja dipertahankan sebagai default. Jika perlu,
        kamu bisa menulis catatan internal di sini tanpa memengaruhi generator link.
      </p>
      <ul class="list-disc ml-6 mt-3 text-sm">
        <li>Origin aktif: <code id="originShow2"></code></li>
        <li>Mode aksi: YouTube hanya “any”, platform lain spesifik (Roblox ikuti/join, WhatsApp gabung, TikTok follow/like/comment).</li>
        <li>Durasi hitung: 11 detik per tugas, otomatis selesai tanpa tombol “Selesai”.</li>
      </ul>
    </section>
  </main>

  <script>
    const $ = (s)=>document.querySelector(s);
    const originShow = $('#originShow');
    const originShow2 = $('#originShow2');
    originShow.textContent = location.origin;
    originShow2.textContent = location.origin;

    const platformEl = $('#platform');
    const actionEl   = $('#action');
    const targetsEl  = $('#targets');
    const genBtn     = $('#genBtn');
    const copyBtn    = $('#copyBtn');
    const openBtn    = $('#openBtn');
    const resultEl   = $('#result');

    // ===== Mapping aksi per platform =====
    // catatan: hanya YouTube yang boleh "any"
    const ACTIONS = {
      youtube: [
        { value:'any', label:'any (bebas: like/sub/tonton/hype)' }
      ],
      roblox: [
        { value:'follow', label:'ikuti akun Roblox' },
        { value:'join',   label:'bergabung ke grup Roblox' }
      ],
      whatsapp: [
        { value:'join', label:'gabung komunitas WhatsApp' }
      ],
      tiktok: [
        { value:'follow',  label:'follow akun TikTok' },
        { value:'like',    label:'like video TikTok' },
        { value:'comment', label:'comment video TikTok' }
      ],
      lainnya: [
        { value:'visit', label:'kunjungi link' }
      ]
    };

    function fillActionOptions(){
      const pf = platformEl.value;
      const opts = ACTIONS[pf] || ACTIONS['lainnya'];
      actionEl.innerHTML = '';
      for(const o of opts){
        const op = document.createElement('option');
        op.value = o.value; op.textContent = o.label;
        actionEl.appendChild(op);
      }
    }
    platformEl.addEventListener('change', fillActionOptions);
    fillActionOptions(); // initial

    function encodeData(obj){
      const json = JSON.stringify(obj);
      // konsisten dengan viewer/task decoder: decodeURIComponent(atob(x))
      return btoa(encodeURIComponent(json));
    }

    function buildTaskUrl(payload){
      const base = `${location.origin}/task/`;
      return `${base}?data=${payload}`;
    }

    function normalizeTargets(text){
      return text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    }

    function labelForTask(platform, action){
      // ini label yang muncul pada kartu Task (bukan di URL)
      // mengikuti kebijakan: YouTube → any; selain itu spesifik.
      switch(platform){
        case 'youtube': return 'YouTube · any';
        case 'roblox':  return action==='join' ? 'Roblox · join' : 'Roblox · follow';
        case 'whatsapp':return 'WhatsApp · gabung';
        case 'tiktok':
          if(action==='follow') return 'TikTok · follow';
          if(action==='like')   return 'TikTok · like';
          return 'TikTok · comment';
        default: return 'Tugas';
      }
    }

    genBtn.addEventListener('click', ()=>{
      const platform = platformEl.value;
      const action   = actionEl.value;
      const targets  = normalizeTargets(targetsEl.value);

      if(targets.length === 0){
        alert('Isi setidaknya satu URL target.');
        return;
      }

      // payload minimal yang dipakai di /task
      const dataObj = {
        platform, action, targets,
        // label akan dibaca frontend task untuk menulis "Tugas YouTube any", dst.
        label: labelForTask(platform, action),
        // opsi tema/aksen custom kalau nanti kamu aktifkan
        custom: {}
      };

      const payload = encodeData(dataObj);
      const url = buildTaskUrl(payload);

      resultEl.value = url;
      openBtn.href = url;
    });

    copyBtn.addEventListener('click', ()=>{
      const v = resultEl.value || '';
      if(!v){ return; }
      navigator.clipboard.writeText(v).then(()=>{
        copyBtn.textContent = '✅ Disalin';
        setTimeout(()=>{ copyBtn.textContent = '📋 Salin'; }, 1200);
      });
    });
  </script>
</body>
</html>
